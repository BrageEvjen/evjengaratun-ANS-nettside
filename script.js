// Translations
const translations = {
    nb: { // Bokmål
        nav: {
            services: 'Tjenester',
            about: 'Om oss',
            contact: 'Kontakt',
            cta: 'Ta kontakt'
        },
        hero: {
            status: 'Ledige for nye oppdrag',
            title: 'Digitale løsninger uten støy',
            subtitle: 'Vi hjelper deg med web, utvikling og IT. Enkelt forklart, solid levert.',
            ctaPrimary: 'Snakk med oss',
            ctaSecondary: 'Tjenester'
        },
        services: {
            title: 'Tjenester',
            subtitle: 'Det vi kan hjelpe deg med',
            webdesign: {
                name: 'Webdesign',
                desc: 'Nye nettsider eller oppgradering av eksisterende'
            },
            development: {
                name: 'Utvikling',
                desc: 'Skreddersydd programvare for dine behov'
            },
            maintenance: {
                name: 'Drift & vedlikehold',
                desc: 'Vi holder nettsiden din oppdatert og sikker'
            },
            consulting: {
                name: 'IT-rådgivning',
                desc: 'Strategisk hjelp til forbedring av system'
            },
            database: {
                name: 'Database-admin',
                desc: 'Sikker lagring og strukturert datahåndtering'
            }
        },
        why: {
            title: 'Hvorfor oss?',
            subtitle: 'Fire ting vi står for',
            clarity: {
                title: 'Klarhet',
                desc: 'Ingen komplisert sjargong. Vi forklarer ting så det gir mening.'
            },
            control: {
                title: 'Kontroll',
                desc: 'Du vet alltid hva som skjer og hva det koster. Ingen overraskelser.'
            },
            quality: {
                title: 'Kvalitet',
                desc: 'Vi leverer ikke halvveis. Det skal være solid og holde over tid.'
            },
            availability: {
                title: 'Tilgjengelighet',
                desc: 'Vi svarer raskt og er lette å få tak i når du trenger oss.'
            }
        },
        contact: {
            title: 'Send oss en beskjed',
            subtitle: 'Vi svarer innen 24 timer',
            name: 'Navn',
            email: 'E-post',
            message: 'Fortell oss hva du trenger hjelp med...',
            submit: 'Send melding'
        },
        footer: {
            description: 'Digitale løsninger uten unødvendig kompleksitet. Basert i Norge.',
            services: 'Tjenester',
            contact: 'Kontakt',
            privacy: 'Personvern',
            terms: 'Vilkår'
        }
    },
    nn: { // Nynorsk
        nav: {
            services: 'Tjenester',
            about: 'Om oss',
            contact: 'Kontakt',
            cta: 'Ta kontakt'
        },
        hero: {
            status: 'Ledige for nye oppdrag',
            title: 'Digitale løysingar utan støy',
            subtitle: 'Vi hjelper deg med web, utvikling og IT. Enkelt forklart, solid levert.',
            ctaPrimary: 'Snakk med oss',
            ctaSecondary: 'Tjenester'
        },
        services: {
            title: 'Tjenester',
            subtitle: 'Det vi kan hjelpe deg med',
            webdesign: {
                name: 'Webdesign',
                desc: 'Nye nettsider eller oppgradering av eksisterande'
            },
            development: {
                name: 'Utvikling',
                desc: 'Skreddarsydd programvare for dine behov'
            },
            maintenance: {
                name: 'Drift & vedlikehald',
                desc: 'Vi held nettsida di oppdatert og sikker'
            },
            consulting: {
                name: 'IT-rådgiving',
                desc: 'Strategisk hjelp til forbetring av system'
            },
            database: {
                name: 'Database-admin',
                desc: 'Sikker lagring og strukturert datahandtering'
            }
        },
        why: {
            title: 'Kvifor oss?',
            subtitle: 'Fire ting vi står for',
            clarity: {
                title: 'Klarheit',
                desc: 'Ingen komplisert sjargong. Vi forklarar ting så det gir meining.'
            },
            control: {
                title: 'Kontroll',
                desc: 'Du veit alltid kva som skjer og kva det kostar. Ingen overraskingar.'
            },
            quality: {
                title: 'Kvalitet',
                desc: 'Vi leverer ikkje halvvegs. Det skal vere solid og halde over tid.'
            },
            availability: {
                title: 'Tilgjenge',
                desc: 'Vi svarar raskt og er lette å få tak i når du treng oss.'
            }
        },
        contact: {
            title: 'Send oss ein beskjed',
            subtitle: 'Vi svarar innan 24 timar',
            name: 'Namn',
            email: 'E-post',
            message: 'Fortel oss kva du treng hjelp med...',
            submit: 'Send melding'
        },
        footer: {
            description: 'Digitale løysingar utan unødvendig kompleksitet. Basert i Noreg.',
            services: 'Tjenester',
            contact: 'Kontakt',
            privacy: 'Personvern',
            terms: 'Vilkår'
        }
    },
    en: { // English
        nav: {
            services: 'Services',
            about: 'About us',
            contact: 'Contact',
            cta: 'Get in touch'
        },
        hero: {
            status: 'Available for new projects',
            title: 'Digital solutions without the noise',
            subtitle: 'We help you with web, development and IT. Simply explained, solidly delivered.',
            ctaPrimary: 'Talk to us',
            ctaSecondary: 'Services'
        },
        services: {
            title: 'Services',
            subtitle: 'What we can help you with',
            webdesign: {
                name: 'Web design',
                desc: 'New websites or upgrading existing ones'
            },
            development: {
                name: 'Development',
                desc: 'Custom software for your needs'
            },
            maintenance: {
                name: 'Operations & maintenance',
                desc: 'We keep your website updated and secure'
            },
            consulting: {
                name: 'IT consulting',
                desc: 'Strategic help to improve systems'
            },
            database: {
                name: 'Database admin',
                desc: 'Secure storage and structured data management'
            }
        },
        why: {
            title: 'Why us?',
            subtitle: 'Four things we stand for',
            clarity: {
                title: 'Clarity',
                desc: 'No complicated jargon. We explain things so they make sense.'
            },
            control: {
                title: 'Control',
                desc: 'You always know what\'s happening and what it costs. No surprises.'
            },
            quality: {
                title: 'Quality',
                desc: 'We don\'t deliver halfway. It should be solid and last over time.'
            },
            availability: {
                title: 'Availability',
                desc: 'We respond quickly and are easy to reach when you need us.'
            }
        },
        contact: {
            title: 'Send us a message',
            subtitle: 'We respond within 24 hours',
            name: 'Name',
            email: 'Email',
            message: 'Tell us what you need help with...',
            submit: 'Send message'
        },
        footer: {
            description: 'Digital solutions without unnecessary complexity. Based in Norway.',
            services: 'Services',
            contact: 'Contact',
            privacy: 'Privacy',
            terms: 'Terms'
        }
    }
};

// Language management
let currentLanguage = localStorage.getItem('language') || 'nb'; // Default to Bokmål

function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    document.documentElement.lang = lang;
    updateContent();
    updateLanguageSelector();
}

function updateContent() {
    const t = translations[currentLanguage];

    // Navigation
    document.querySelector('.nav-links a[href="#tjenester"]').textContent = t.nav.services;
    document.querySelector('.nav-links a[href="#om"]').textContent = t.nav.about;
    document.querySelector('.nav-links a[href="#kontakt"]').textContent = t.nav.contact;
    document.querySelector('.nav-cta').textContent = t.nav.cta;

    // Hero
    document.querySelector('.hero-status').textContent = t.hero.status;
    document.querySelector('.hero h1').textContent = t.hero.title;
    document.querySelector('.hero p').textContent = t.hero.subtitle;
    document.querySelector('.btn-primary').textContent = t.hero.ctaPrimary;
    document.querySelector('.btn-secondary').textContent = t.hero.ctaSecondary;

    // Services
    document.querySelector('.services h2').textContent = t.services.title;
    document.querySelector('.services-header p').textContent = t.services.subtitle;

    const serviceItems = document.querySelectorAll('.service-item');
    serviceItems[0].querySelector('.service-name').textContent = t.services.webdesign.name;
    serviceItems[0].querySelector('.service-desc').textContent = t.services.webdesign.desc;
    serviceItems[1].querySelector('.service-name').textContent = t.services.development.name;
    serviceItems[1].querySelector('.service-desc').textContent = t.services.development.desc;
    serviceItems[2].querySelector('.service-name').textContent = t.services.maintenance.name;
    serviceItems[2].querySelector('.service-desc').textContent = t.services.maintenance.desc;
    serviceItems[3].querySelector('.service-name').textContent = t.services.consulting.name;
    serviceItems[3].querySelector('.service-desc').textContent = t.services.consulting.desc;
    serviceItems[4].querySelector('.service-name').textContent = t.services.database.name;
    serviceItems[4].querySelector('.service-desc').textContent = t.services.database.desc;

    // Why us
    document.querySelector('.why-us h2').textContent = t.why.title;
    document.querySelector('.why-header p').textContent = t.why.subtitle;

    const whyCards = document.querySelectorAll('.why-card');
    whyCards[0].querySelector('h3').innerHTML = `<span>✓</span> ${t.why.clarity.title}`;
    whyCards[0].querySelector('p').textContent = t.why.clarity.desc;
    whyCards[1].querySelector('h3').innerHTML = `<span>✓</span> ${t.why.control.title}`;
    whyCards[1].querySelector('p').textContent = t.why.control.desc;
    whyCards[2].querySelector('h3').innerHTML = `<span>✓</span> ${t.why.quality.title}`;
    whyCards[2].querySelector('p').textContent = t.why.quality.desc;
    whyCards[3].querySelector('h3').innerHTML = `<span>✓</span> ${t.why.availability.title}`;
    whyCards[3].querySelector('p').textContent = t.why.availability.desc;

    // Contact
    document.querySelector('.contact h2').textContent = t.contact.title;
    document.querySelector('.contact-header p').textContent = t.contact.subtitle;
    document.querySelectorAll('.contact-form input')[0].placeholder = t.contact.name;
    document.querySelectorAll('.contact-form input')[1].placeholder = t.contact.email;
    document.querySelector('.contact-form textarea').placeholder = t.contact.message;
    document.querySelector('.contact-form button').textContent = t.contact.submit;

    // Footer
    document.querySelector('.footer-brand p').textContent = t.footer.description;
    document.querySelector('.footer-section h4').textContent = t.footer.services;
    document.querySelectorAll('.footer-section')[1].querySelector('h4').textContent = t.footer.contact;

    const footerServices = document.querySelectorAll('.footer-section ul li a');
    footerServices[0].textContent = t.services.webdesign.name;
    footerServices[1].textContent = t.services.development.name;
    footerServices[2].textContent = t.services.maintenance.name;
    footerServices[3].textContent = t.services.consulting.name;

    document.querySelectorAll('.footer-legal a')[0].textContent = t.footer.privacy;
    document.querySelectorAll('.footer-legal a')[1].textContent = t.footer.terms;
}

function updateLanguageSelector() {
    document.querySelectorAll('.lang-option').forEach(option => {
        option.classList.remove('active');
        if (option.dataset.lang === currentLanguage) {
            option.classList.add('active');
        }
    });
}

// Mobile menu toggle
const menuToggle = document.querySelector('.menu-toggle');
const navLinks = document.querySelector('.nav-links');

menuToggle.addEventListener('click', () => {
    menuToggle.classList.toggle('active');
    navLinks.classList.toggle('active');
});

// Close menu when clicking on a link
const navItems = document.querySelectorAll('.nav-links a');
navItems.forEach(item => {
    item.addEventListener('click', () => {
        menuToggle.classList.remove('active');
        navLinks.classList.remove('active');
    });
});

// Close menu when clicking outside
document.addEventListener('click', (e) => {
    if (!navLinks.contains(e.target) && !menuToggle.contains(e.target)) {
        menuToggle.classList.remove('active');
        navLinks.classList.remove('active');
    }
});

// Contact form submission
const contactForm = document.getElementById('contactForm');
const formStatus = document.getElementById('formStatus');

const statusMessages = {
    nb: {
        sending: 'Sender melding...',
        success: 'Melding sendt! Vi svarer innen 24 timer.',
        error: 'Noe gikk galt. Prøv igjen eller send e-post direkte til kontakt@evjengaratun.no'
    },
    nn: {
        sending: 'Sender melding...',
        success: 'Melding sendt! Vi svarar innan 24 timar.',
        error: 'Noko gjekk galt. Prøv igjen eller send e-post direkte til kontakt@evjengaratun.no'
    },
    en: {
        sending: 'Sending message...',
        success: 'Message sent! We will respond within 24 hours.',
        error: 'Something went wrong. Please try again or email us directly at kontakt@evjengaratun.no'
    }
};

async function handleFormSubmit(e) {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const message = document.getElementById('message').value;

    // Show sending status
    formStatus.textContent = statusMessages[currentLanguage].sending;
    formStatus.className = 'form-status form-status-sending';
    submitBtn.disabled = true;

    try {
        const response = await fetch('/api/send-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name,
                email,
                message,
                language: currentLanguage
            }),
        });

        const data = await response.json();

        if (response.ok) {
            // Success
            formStatus.textContent = statusMessages[currentLanguage].success;
            formStatus.className = 'form-status form-status-success';
            contactForm.reset();

            // Clear success message after 5 seconds
            setTimeout(() => {
                formStatus.textContent = '';
                formStatus.className = 'form-status';
            }, 5000);
        } else {
            // Error from server
            throw new Error(data.error || 'Failed to send message');
        }
    } catch (error) {
        console.error('Error submitting form:', error);
        formStatus.textContent = statusMessages[currentLanguage].error;
        formStatus.className = 'form-status form-status-error';
    } finally {
        submitBtn.disabled = false;
    }
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', () => {
    setLanguage(currentLanguage);

    // Language selector event listeners
    document.querySelectorAll('.lang-option').forEach(option => {
        option.addEventListener('click', (e) => {
            e.preventDefault();
            setLanguage(option.dataset.lang);
        });
    });

    // Contact form event listener
    if (contactForm) {
        contactForm.addEventListener('submit', handleFormSubmit);
    }
});
